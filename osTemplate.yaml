kind: Template
apiVersion: v1
labels:
  template: CicdSelfService-dev-deployment
  group: CicdSelfService-dev-deployment
  application: CicdSelfService
  environment: dev
metadata:
  name: CicdSelfService-dev-deployment
message: CicdSelfService Stage Deployment

objects:
#APPLICATION
- kind: Service
  apiVersion: v1
  metadata:
    name: "CicdSelfService-svc"
  spec:
    ports:
    - name: "CicdSelfService-svc"
      port: 9000
      targetPort: 9000
    selector:
      name: "CicdSelfService-dc"
    sessionAffinity: None

#Application Route
- kind: Route
  apiVersion: v1
  metadata:
    name: CicdSelfService-rt
  spec:
    to:
      kind: Service
      name: "CicdSelfService-svc"

# Application ImageStream
- kind: ImageStream
  apiVersion: v1
  metadata:
    name: "CicdSelfService-is"
  spec:
#    dockerImageRepository: "/CicdSelfService"
    dockerImageRepository: ""
#    tags:
#    - from:
#      kind: dockerImageRepository
#      name: "/CicdSelfService:0.0"
    importPolicy:
      insecure: true
    name: latest

- kind: DeploymentConfig
  apiVersion: v1
  metadata:
    name: "CicdSelfService-dc"
  spec:
    replicas: 1
    selector:
      name: "CicdSelfService-dc"
    strategy:
      type: Rolling
    template:
      metadata:
        labels:
          name: "CicdSelfService-dc"
      spec:
        containers:
        - name: CicdSelfService
          image: "CicdSelfService-is"
          ports:
          - containerPort: 9000
          imagePullPolicy: Always
          livenessProbe:
            httpGet:
              path: /myservice
              port: 9000
            initialDelaySeconds: 30
            timeoutSeconds: 3
          readinessProbe:
            httpGet:
              path: /myservice
              port: 9000
            initialDelaySeconds: 3
            timeoutSeconds: 1
            periodSeconds: 2
            seccessThreashold: 1
            failureThreashold: 5
          resources:
            limits:
              memory: 512Mi
    triggers:
    - type: ConfigChange
    - type: ImageChange
      imageChangeParams:
        automatic: true
        containerNames:
        - "CicdSelfService"
        from:
          kind: ImageStream
          name: "CicdSelfService-is"
